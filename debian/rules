#!/usr/bin/make -f
# -*- makefile -*-
# vi: ts=4 sw=4 noet
#
# debian/rules file that uses debhelper
# Based on an autogenerated debhelper sample
#

# Uncomment this to turn on verbose mode
#export DH_VERBOSE=1

CPPFLAGS:=$(shell dpkg-buildflags --get CPPFLAGS)
CFLAGS:=$(shell dpkg-buildflags --get CFLAGS) $(CPPFLAGS)
CXXFLAGS:=$(shell dpkg-buildflags --get CXXFLAGS) $(CPPFLAGS)
LDFLAGS:=$(shell dpkg-buildflags --get LDFLAGS)

EXTRA_CMAKE_FLAGS =

ifneq (,$(filter $(DEB_BUILD_ARCH_CPU),i386 amd64))
	EXTRA_CMAKE_FLAGS += -DENABLE_ASM_SCALERS=ON
endif

%:
	dh $@ --buildsystem=cmake --builddirectory=builddir --parallel

override_dh_auto_configure:
	mkdir -p builddir
	cd builddir && cmake .. \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_C_FLAGS="$(CFLAGS)" \
		-DCMAKE_CXX_FLAGS="$(CXXFLAGS)" \
		-DCMAKE_SHARED_LINKER_FLAGS="$(LDFLAGS)" \
		-DCMAKE_VERBOSE_MAKEFILE=ON \
		-DENABLE_LIRC=ON \
		-DENABLE_FFMPEG=ON \
		$(EXTRA_CMAKE_FLAGS) \
		-DENABLE_WX=ON
